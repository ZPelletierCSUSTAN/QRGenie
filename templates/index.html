{% extends "base.html" %}
{% block content %}
<div class="card border-secondary shadow-lg">
    <div class="card-body p-4">
        <h1 class="text-center text-accent mb-4">QR Code Generator</h1>
        <div class="mb-3">
            <label class="form-label text-muted">Content (URL or Text):</label>
            <input type="text" class="form-control" id="text" placeholder="Type here..." autocomplete="off">
        </div>
        <div class="row mb-3">
            <div class="col-md-6"><label class="form-label text-muted">Size:</label><input type="range" class="form-range" id="size" min="5" max="20" value="10"></div>
            <div class="col-md-6"><label class="form-label text-muted">Border Width:</label><input type="range" class="form-range" id="border" min="0" max="10" value="4"></div>
        </div>
        <div class="row mb-3">
            <div class="col-md-4"><label class="form-label text-muted">Shape:</label>
                <select id="shape" class="form-select">
                    <option value="square">Square</option><option value="rounded">Rounded</option>
                    <option value="circle">Circle</option><option value="gapped">Gapped</option>
                    <option value="vertical">Vertical</option><option value="horizontal">Horizontal</option>
                </select>
            </div>
            <div class="col-md-4"><label class="form-label text-muted">Body Color:</label><input type="color" class="form-control form-control-color w-100" id="color" value="#000000"></div>
            <div class="col-md-4"><label class="form-label text-muted">Background Color:</label><input type="color" class="form-control form-control-color w-100" id="bg_color" value="#ffffff"></div>
        </div>
        <div class="preview-pane text-center mt-4 pt-4 border-top border-secondary">
            <h3 class="text-accent">Live Preview</h3>
            <div id="placeholder" class="text-muted fst-italic my-4">Start typing above to generate...</div>
            <img id="live-qr" class="qr-img img-fluid" style="display: none;">
            <br><a id="download-link" href="#" class="btn btn-primary mt-3" style="display: none;">Save QR Code</a>
        </div>
    </div>
</div>
<script>
    const ids = ['text', 'size', 'border', 'color', 'bg_color', 'shape'];
    const els = ids.map(id => document.getElementById(id));
    const [txt, sz, brd, col, bg, shp] = els;
    const img = document.getElementById('live-qr'), dl = document.getElementById('download-link'), ph = document.getElementById('placeholder');

    function up() {
        if (!txt.value.trim()) { img.style.display='none'; dl.style.display='none'; ph.style.display='block'; return; }
        fetch('/api/generate', {
            method: 'POST', headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({text: txt.value, size: sz.value, border: brd.value, color: col.value, bg_color: bg.value, shape: shp.value})
        }).then(r=>r.json()).then(d=>{
            if(d.success){ ph.style.display='none'; img.src=d.image; img.style.display='inline-block'; dl.href=d.image; dl.download='qr_genie.png'; dl.style.display='inline-block'; }
        });
    }
    els.forEach(el => el.addEventListener(el.tagName==='SELECT'?'change':'input', up));
</script>
{% endblock %}