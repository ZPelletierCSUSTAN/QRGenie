{% extends "base.html" %}

{% block content %}
<div class="card">
    <!-- CENTERED TITLE -->
    <h1 class="text-center">QR Code Generator</h1>
    
    <div class="controls-section">
        <div class="form-group">
            <label for="text">Content (URL or Text):</label>
            <input type="text" id="text" placeholder="Type here to see magic..." autocomplete="off">
        </div>

        <div class="form-row">
            <div class="form-group">
                <label for="size">Size:</label>
                <input type="range" id="size" min="5" max="20" value="10">
            </div>
            <div class="form-group">
                <label for="border">Border Width:</label>
                <input type="range" id="border" min="0" max="10" value="4">
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label for="shape">Shape Style:</label>
                <!-- ADDED NEW SHAPES -->
                <select id="shape" style="width: 100%;">
                    <option value="square">Square (Standard)</option>
                    <option value="rounded">Rounded Squares</option>
                    <option value="circle">Dots / Circles</option>
                    <option value="gapped">Gapped Squares</option>
                    <option value="vertical">Vertical Bars</option>
                    <option value="horizontal">Horizontal Bars</option>
                </select>
                <small style="color: var(--text-muted); font-size: 0.8rem;">Change selection to preview style.</small>
            </div>
            <div class="form-group">
                <label for="color">Body Color:</label>
                <input type="color" id="color" value="#000000" style="width: 100%; height: 43px;">
            </div>
            <div class="form-group">
                <!-- UPDATED LABEL -->
                <label for="bg_color">Background Color:</label>
                <input type="color" id="bg_color" value="#ffffff" style="width: 100%; height: 43px;">
            </div>
        </div>
    </div>

    <!-- PREVIEW PANE -->
    <div class="preview-pane">
        <h3 style="border-top: 1px solid var(--border-color); padding-top: 20px; margin-top: 10px;">Live Preview</h3>
        
        <div id="placeholder-text" style="color: var(--text-muted); font-style: italic; margin-bottom: 20px;">
            Start typing above to generate...
        </div>
        
        <img id="live-qr" class="qr-img" style="display: none;">
        
        <br>
        <a id="download-link" href="#" class="btn-secondary" style="display: none;">Save QR Code</a>
    </div>
</div>

<script>
    const textInput = document.getElementById('text');
    const sizeInput = document.getElementById('size');
    const borderInput = document.getElementById('border');
    const colorInput = document.getElementById('color');
    const bgInput = document.getElementById('bg_color');
    const shapeInput = document.getElementById('shape');
    
    const imgEl = document.getElementById('live-qr');
    const dlLink = document.getElementById('download-link');
    const placeholder = document.getElementById('placeholder-text');

    function updateQR() {
        const text = textInput.value;
        const size = sizeInput.value;
        const color = colorInput.value;
        const bgColor = bgInput.value;
        const border = borderInput.value;
        const shape = shapeInput.value;

        if (text.trim() === "") {
            imgEl.style.display = 'none';
            dlLink.style.display = 'none';
            placeholder.style.display = 'block';
            return;
        }

        fetch('/api/generate', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ 
                text: text, 
                size: size, 
                color: color, 
                bg_color: bgColor,
                border: border,
                shape: shape
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                placeholder.style.display = 'none';
                imgEl.src = data.image;
                imgEl.style.display = 'inline-block';
                dlLink.href = data.image;
                dlLink.download = "qr_genie.png";
                dlLink.style.display = 'inline-block';
            }
        });
    }

    textInput.addEventListener('input', updateQR);
    sizeInput.addEventListener('input', updateQR);
    borderInput.addEventListener('input', updateQR);
    colorInput.addEventListener('input', updateQR);
    bgInput.addEventListener('input', updateQR);
    shapeInput.addEventListener('change', updateQR);
</script>
{% endblock %}