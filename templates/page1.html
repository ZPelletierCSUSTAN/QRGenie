{% extends "page5.html" %}
{% block content %}
<div class="card shadow-lg">
    <div class="card-body p-4">
        <h1 class="text-center text-accent mb-4">QR Code Generator</h1>
        
        <div class="mb-3">
            <label for="text" class="form-label text-muted">Content (URL or Text):</label>
            <input type="text" class="form-control" id="text" placeholder="Type here..." autocomplete="off">
        </div>

        <div class="row mb-3">
            <div class="col-md-6">
                <label for="size" class="form-label text-muted">Size:</label>
                <input type="range" class="form-range" id="size" min="5" max="20" value="10">
            </div>
            <div class="col-md-6">
                <label for="border" class="form-label text-muted">Border Width:</label>
                <input type="range" class="form-range" id="border" min="0" max="10" value="4">
            </div>
        </div>

        <div class="row mb-3">
            <div class="col-md-4">
                <label for="shape" class="form-label text-muted">Shape Style:</label>
                <select id="shape" class="form-select">
                    <option value="square">Square</option><option value="rounded">Rounded</option>
                    <option value="circle">Circle</option><option value="gapped">Gapped</option>
                    <option value="vertical">Vertical</option><option value="horizontal">Horizontal</option>
                </select>
            </div>
            <div class="col-md-4">
                <label for="color" class="form-label text-muted">Body Color:</label>
                <input type="color" class="form-control form-control-color w-100" id="color" value="#000000">
            </div>
            <div class="col-md-4">
                <label for="bg_color" class="form-label text-muted">Background Color:</label>
                <input type="color" class="form-control form-control-color w-100" id="bg_color" value="#ffffff">
            </div>
        </div>
        
        <div class="preview-pane text-center mt-4 pt-4 border-top border-secondary">
            <h3 class="text-accent">Live Preview</h3>
            <div id="placeholder-text" class="text-muted fst-italic my-4">Start typing above to generate...</div>
            <img id="live-qr" class="qr-img img-fluid" style="display: none;">
            <br>
            <a id="download-link" href="#" class="btn btn-primary mt-3" style="display: none;">Save QR Code</a>
        </div>
    </div>
</div>
<script>
    const textInput = document.getElementById('text');
    const sizeInput = document.getElementById('size');
    const borderInput = document.getElementById('border');
    const colorInput = document.getElementById('color');
    const bgInput = document.getElementById('bg_color');
    const shapeInput = document.getElementById('shape');
    
    const imgEl = document.getElementById('live-qr');
    const dlLink = document.getElementById('download-link');
    const placeholder = document.getElementById('placeholder-text');

    function updateQR() {
        const text = textInput.value;
        if (text.trim() === "") {
            imgEl.style.display = 'none';
            dlLink.style.display = 'none';
            placeholder.style.display = 'block';
            return;
        }

        fetch('/api/generate', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ 
                text: text, size: sizeInput.value, color: colorInput.value, 
                bg_color: bgInput.value, border: borderInput.value, shape: shapeInput.value
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                placeholder.style.display = 'none';
                imgEl.src = data.image;
                imgEl.style.display = 'inline-block';
                dlLink.href = data.image;
                dlLink.download = "qr_genie.png";
                dlLink.style.display = 'inline-block';
            }
        });
    }

    [textInput, sizeInput, borderInput, colorInput, bgInput, shapeInput].forEach(input => {
        input.addEventListener(input.tagName === 'SELECT' ? 'change' : 'input', updateQR);
    });
</script>
{% endblock %}